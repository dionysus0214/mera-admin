<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="org.mera.mapper.EnvMapper">

<sql id="criteria">
    <trim prefix="WHERE">
        <choose>
            <when test= "category == 'NM'.toString()">
                env_nm LIKE CONCAT('%', #{keyword}, '%')
            </when>
            <when test= "category == 'TITLE'.toString()">
                env_title LIKE CONCAT('%', #{keyword}, '%')
            </when>
            <when test= "category == 'VAL'.toString()">
                env_val LIKE CONCAT('%', #{keyword}, '%')
            </when>
            <when test= "category == 'YN'.toString()">
                use_yn LIKE CONCAT('%', #{keyword}, '%')
            </when>
        </choose>
    </trim>
</sql>

<select id="getList" resultType="org.mera.domain.EnvVO">
<![CDATA[
    SELECT @ROWNUM := @ROWNUM + 1 AS rownum, met.* 
    FROM mera_env_test met, (SELECT @ROWNUM := 0) R
    ORDER BY rownum desc
]]>
</select>

<select id="getListWithPaging" resultType="org.mera.domain.EnvVO">
<![CDATA[
    SELECT @ROWNUM := @ROWNUM + 1 AS rownum, met.* 
    FROM mera_env_test met, (SELECT @ROWNUM := 0) R
]]>
<include refid="criteria"></include>
<![CDATA[
    ORDER BY rownum desc
    LIMIT #{startPage}, #{amount}
]]>
</select>

<select id="read" resultType="org.mera.domain.EnvVO">
<![CDATA[
    SELECT * FROM mera_env_test
    WHERE seq = #{seq}
]]>
</select>

<insert id="insert">
    INSERT INTO mera_env_test (env_nm, env_title, env_val, use_yn)
    VALUES (#{env_nm}, #{env_title}, #{env_val}, #{use_yn})
</insert>

<delete id="delete">
    DELETE FROM mera_env_test WHERE seq = #{seq}
</delete>

<update id="update">
    UPDATE mera_env_test 
    SET env_nm = #{env_nm}, env_title = #{env_title}, env_val = #{env_val}, use_yn = #{use_yn}, upd_dt = CURRENT_TIMESTAMP
    WHERE seq = #{seq}
</update>

<select id="getTotalCount" resultType="int">
<![CDATA[
    SELECT count(*) FROM mera_env_test
]]>
<include refid="criteria"></include>
</select>

</mapper>