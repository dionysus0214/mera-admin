<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="org.mera.mapper.TestViewMapper">

    <select id="getList"  resultType="org.mera.domain.TestViewVO">
        <![CDATA[
        SELECT stat_date, api_cd, ccm.com_cd_nm as api_nm, count(*) tot_cnt
        FROM mera_stat_info mi
            left join com_cd_mltl ccm
                on ccm.com_cd = mi.api_cd and ccm.langg_cd='CM00100002'
        WHERE stat_date >= '20210308' and stat_date <= '20210315'
        GROUP BY stat_date, api_cd
        ORDER BY stat_date desc, tot_cnt desc
        ]]>
    </select>

    <select id="getListWithPaging"  resultType="org.mera.domain.TestViewVO">
    <![CDATA[
        SELECT stat_date, api_cd, ccm.com_cd_nm as api_nm, count(*) tot_cnt
        FROM mera_stat_info mi
            left join com_cd_mltl ccm
                on ccm.com_cd = mi.api_cd and ccm.langg_cd='CM00100002'
        WHERE stat_date >= '20210308' and stat_date <= '20210315'
        GROUP BY stat_date, api_cd
        ORDER BY stat_date desc, tot_cnt desc
        LIMIT #{pageStart}, #{perPageNum}
        ]]>
    </select>

    <select id="getTotalCount" resultType="int">
    <![CDATA[
		SELECT count(*) FROM (SELECT stat_date, api_cd, ccm.com_cd_nm as api_nm, count(*) tot_cnt 
        FROM mera_stat_info mi 
            left join com_cd_mltl ccm 
                on ccm.com_cd = mi.api_cd and ccm.langg_cd='CM00100002' 
        WHERE stat_date >= '20210308' and stat_date <= '20210315' 
        GROUP BY stat_date, api_cd 
        ORDER BY stat_date desc, tot_cnt desc) total_count
    ]]>
	</select>

</mapper>
